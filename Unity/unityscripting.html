

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Scripting &mdash; Simul  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="trueSKY SDK" href="../sdk.html" />
    <link rel="prev" title="Unity Tutorial" href="unitytutorial.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Simul
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation and Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorialsindex.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../unrealindex.html">trueSKY for Unreal Engine 4</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../unityindex.html">trueSKY for Unity</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="unitytutorial.html">Unity Tutorial</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Scripting</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#truesky-object">trueSKY Object</a></li>
<li class="toctree-l3"><a class="reference internal" href="#layers">Layers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#for-truesky-4-1a">For trueSKY 4.1a</a></li>
<li class="toctree-l3"><a class="reference internal" href="#keyframes">Keyframes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id1">For trueSKY 4.1a</a></li>
<li class="toctree-l3"><a class="reference internal" href="#other-functions">Other Functions</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../sdk.html">trueSKY SDK</a></li>
<li class="toctree-l1"><a class="reference internal" href="../skysequencer.html">Simul Sky Sequencer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../programmingindex.html">Programming Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../legalindex.html">trueSKY Licences</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../API/apiindex.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Reference/referenceindex.html">Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../changelist.html">Changelist</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Simul</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../unityindex.html">trueSKY for Unity</a> &raquo;</li>
        
      <li>Scripting</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/Unity/unityscripting.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="scripting">
<h1>Scripting<a class="headerlink" href="#scripting" title="Permalink to this headline">¶</a></h1>
<p>Alongside the Sequencer tool, trueSKY can be driven and configured via Unity scripting. Similarly to using the sequencer, the settings and properties in trueSKY for Unity are split between <a class="reference internal" href="#keyframes">Keyframes</a> properties (temporal values for clouds and sky), <a class="reference internal" href="#layers">Layers</a> properites (values for clouds and sky that persist throughout a sequence) and the properties of the <a class="reference internal" href="#truesky-object">trueSKY object</a> itself (configuration settings).</p>
<div class="section" id="truesky-object">
<h2>trueSKY Object<a class="headerlink" href="#truesky-object" title="Permalink to this headline">¶</a></h2>
<p>To modify trueSKY object via scripting, a reference to the active object in the scene must first be obtained (there should only be one). This can be done upon initialisation; the code to do so is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">simul</span><span class="o">.</span><span class="n">trueSKY</span> <span class="n">trueSky</span><span class="o">=</span><span class="n">simul</span><span class="o">.</span><span class="n">trueSKY</span><span class="o">.</span><span class="n">GetTrueSky</span><span class="p">();</span>
</pre></div>
</div>
<p>All editor properties of the trueSKY object are publicly accessible, so once a reference to the trueSKY object has been obtained, they can also be accessed and modified via scripting. For example, to disable depth blending:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">private</span> <span class="n">simul</span><span class="o">.</span><span class="n">trueSKY</span> <span class="n">tS</span><span class="p">;</span>

<span class="n">void</span> <span class="n">Start</span> <span class="p">()</span>
<span class="p">{</span>
        <span class="n">tS</span> <span class="o">=</span> <span class="n">simul</span><span class="o">.</span><span class="n">trueSKY</span><span class="o">.</span><span class="n">GetTrueSky</span> <span class="p">();</span>
        <span class="n">tS</span><span class="o">.</span><span class="n">DepthBlending</span> <span class="o">=</span> <span class="n">false</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="layers">
<h2>Layers<a class="headerlink" href="#layers" title="Permalink to this headline">¶</a></h2>
<p>Layer properties are those accessible in the sequencer by clicking on the layer name on the left of the timeline. These affect the entire sequence and the values will remain until the user changes them manually. This differs in nature from keyframe properties, which are active only between specified times and will be automatically modified via interpolation (for example if two adjacent keyframes have cloudiness set to 0.4 and 0.6 respectively, trueSKY will interpolate these values for times in between, increasing gradually from 0.4 to 0.6). The functions needed to Get and Set layer properties are as follows:</p>
<p><strong>Sky</strong>:</p>
<ul class="simple">
<li><p><strong>GetSkyFloat (string name)</strong>: Gets the sky layer float specified by the name string.</p></li>
<li><p><strong>GetSkyInt (string name)</strong>: Gets the sky layer int specified by the name string.</p></li>
<li><p><strong>SetSkyFloat  (string name, float value)</strong>: Sets the sky layer float specified by the name string to the given float value.</p></li>
<li><p><strong>SetSkyInt  (string name, int value)</strong>: Sets the sky layer int specified by the name string to the given float value.</p></li>
</ul>
<p><strong>Clouds</strong>:</p>
<ul class="simple">
<li><p><strong>GetCloudFloat (string name)</strong>: Gets the 3D cloud layer float specified by the name string.</p></li>
<li><p><strong>GetCloudInt (string name)</strong>: Gets the 3D cloud layer int specified by the name string.</p></li>
<li><p><strong>SetCloudFloat  (string name, float value)</strong>: Sets the 3D cloud layer float specified by the name string to the given float value.</p></li>
<li><p><strong>SetCloudInt  (string name, int value)</strong>: Sets the 3D cloud layer int specified by the name string to the given float value.</p></li>
</ul>
</div>
<div class="section" id="for-truesky-4-1a">
<h2>For trueSKY 4.1a<a class="headerlink" href="#for-truesky-4-1a" title="Permalink to this headline">¶</a></h2>
<p><strong>2D Clouds</strong>:</p>
<ul class="simple">
<li><p><strong>Get2DCloudFloat (string name)</strong>: Gets the 2D cloud layer float specified by the name string.</p></li>
<li><p><strong>Get2DCloudInt (string name)</strong>: Gets the 2D cloud layer int specified by the name string.</p></li>
<li><p><strong>Set2DCloudFloat  (string name, float value)</strong>: Sets the 2D cloud layer float specified by the name string to the given float value.</p></li>
<li><p><strong>Set2DCloudInt  (string name, int value)</strong>: Sets the 2D cloud layer int specified by the name string to the given float value.</p></li>
</ul>
<p><strong>Example</strong>: To increment the Ozone layer strength by 0.1,</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">private</span> <span class="n">trueSKY</span> <span class="n">tS</span><span class="p">;</span>

<span class="n">void</span> <span class="n">Start</span> <span class="p">()</span>
<span class="p">{</span>
        <span class="n">tS</span> <span class="o">=</span> <span class="n">trueSKY</span><span class="o">.</span><span class="n">GetTrueSky</span> <span class="p">();</span>
        <span class="n">tS</span><span class="o">.</span><span class="n">SetSkyFloat</span><span class="p">(</span><span class="s2">&quot;OzoneStrength&quot;</span><span class="p">,</span> <span class="n">tS</span><span class="o">.</span><span class="n">GetSkyFloat</span><span class="p">(</span><span class="s2">&quot;OzoneStrength&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.1</span><span class="n">f</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For information about the layer properties you can change and the name strings needed to do so, see the <a class="reference internal" href="../Tutorials/clouds.html"><span class="doc">Cloud</span></a> and <a class="reference internal" href="../Tutorials/sky.html"><span class="doc">Sky</span></a> pages.</p>
</div>
<div class="section" id="keyframes">
<h2>Keyframes<a class="headerlink" href="#keyframes" title="Permalink to this headline">¶</a></h2>
<p>Keyframes in trueSKY can be accessed, counted, modified, created and deleted via scripting. To delete a keyframe or change its properties, the Unique Identifier (Uid) will need to be known. These can be retrieved either by index (the keyframes in the sequencer, which are zero-indexed) or by retrieving the current/interpolated keyframe (not viewable in the sequencer, as they are interpolated). Uids are unique and persistent for the session, but not across saves or restarts, so they should not be stored. <strong>Note</strong>: For any functions with a layer parameter, the layer indexes are as follows: <strong>0</strong> for the sky, <strong>1</strong> for 3D Clouds and <strong>2</strong> for 2D Clouds (if in 4.1a).</p>
<p><strong>Sky</strong>:</p>
<ul class="simple">
<li><p><strong>GetSkyKeyframeByIndex (int index)</strong>: Get the sky keyframe with specified index.</p></li>
<li><p><strong>GetInterpolatedSkyKeyframe ()</strong>: Retrieve the interpolated (current) sky keyframe.</p></li>
<li><p><strong>InsertSkyKeyframe (float t)</strong>: Insert a sky keyframe at specified time t.</p></li>
<li><p><strong>GetNumSkyKeyframes ()</strong>: Returns the total number of sky keyframes.</p></li>
</ul>
<p><strong>3D Clouds</strong>:</p>
<ul class="simple">
<li><p><strong>GetCloudKeyframeByIndex (int index)</strong>: Get the 3D cloud keyframe with specified index.</p></li>
<li><p><strong>GetInterpolatedCloudKeyframe (int layer = 1)</strong>: Retrieve the interpolated (current) 3D cloud keyframe.</p></li>
<li><p><strong>InsertCloudKeyframe (float t)</strong>: Insert a 3D cloud keyframe at specified time t.</p></li>
<li><p><strong>GetNumCloudKeyframes ()</strong>: Returns the total number of 3D cloud keyframes.</p></li>
</ul>
</div>
<div class="section" id="id1">
<h2>For trueSKY 4.1a<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p><strong>2D Clouds</strong>:</p>
<ul class="simple">
<li><p><strong>GetCloud2DKeyframeByIndex (int index)</strong>: Get the 2D cloud keyframe with specified index.</p></li>
<li><p><strong>GetInterpolatedCloudKeyframe (int layer = 2)</strong>: Retrieve the interpolated (current) 2D cloud keyframe.</p></li>
<li><p><strong>Insert2DCloudKeyframe (float t)</strong>: Insert a 2D cloud keyframe at specified time t.</p></li>
<li><p><strong>GetNumCloud2DKeyframes ()</strong>: Returns the total number of 2D cloud keyframes.</p></li>
</ul>
<p>Once you know the Uid of a keyframe, you can then get the values of its properties, set said values or delete the keyframe. Whether you’re accessing/modifying sky, 3D cloud or 2D cloud keyframes, these tasks are accomplished via the following functions:</p>
<ul class="simple">
<li><p><strong>GetKeyframeValue (uint uid, string name)</strong>: Gets the float or int value of the property specified by the name string, for the keyframe specified by the Uid.</p></li>
<li><p><strong>SetKeyframeValue (uint uid, string name, object value)</strong>: Sets the property specified by the name string, for the keyframe specified by the Uid, to the given value. The value should be an int or float (, though doubles are acceptable in place of floats.</p></li>
<li><p><strong>DeleteKeyframe (uint uid)</strong>: Deletes the keyframe specified by the Uid. This only works on sequencer-viewable keyframes, not interpolated ones.</p></li>
</ul>
<p><strong>Example</strong>: In the script KeyframeTesting.cs in the Simul directory, is a function that sets all the cloud keyframes to have a “cloudiness” of 0.8 when the game is run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">numk</span> <span class="o">=</span> <span class="n">trueSky</span><span class="o">.</span><span class="n">GetNumCloudKeyframes</span><span class="p">();</span>

<span class="k">for</span><span class="p">(</span><span class="nb">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numk</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
<span class="p">{</span>
        <span class="n">uint</span> <span class="n">uid</span> <span class="o">=</span> <span class="n">trueSky</span><span class="o">.</span><span class="n">GetCloudKeyframeByIndex</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="n">trueSky</span><span class="o">.</span><span class="n">SetKeyframeValue</span><span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="s2">&quot;cloudiness&quot;</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p><strong>Example</strong>: Getting the current cloudiness of the interpolated keyframe
.. code-block:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">private</span> <span class="n">trueSKY</span> <span class="n">tS</span><span class="p">;</span>

<span class="n">void</span> <span class="n">Start</span> <span class="p">()</span>
<span class="p">{</span>
        <span class="n">tS</span> <span class="o">=</span> <span class="n">trueSKY</span><span class="o">.</span><span class="n">GetTrueSky</span><span class="p">();</span>
        <span class="n">uint</span> <span class="n">uid</span> <span class="o">=</span> <span class="n">tS</span><span class="o">.</span><span class="n">GetInterpolatedCloudKeyframe</span> <span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="n">tS</span><span class="o">.</span><span class="n">GetKeyframeValue</span> <span class="p">(</span><span class="n">uid</span><span class="p">,</span> <span class="s2">&quot;cloudiness&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="other-functions">
<h2>Other Functions<a class="headerlink" href="#other-functions" title="Permalink to this headline">¶</a></h2>
<p><strong>Queries</strong></p>
<p>TrueSKY for Unity also provides some built in functions to carry out queries at given positions. It is possible to carry out cloud queries at a given position, and cloud line queries across two positions. These will return a VolumeQueryResult and a LineQueryResult respectively. Additionally there are more simplified functions for when you want just one value, for example, the amount of rain at a given position. Where applicable, id parameters should be given any unique integer (calling another query with the same id will overwrite the former). The functions are as follows:</p>
<ul class="simple">
<li><p><strong>GetCloudQuery (int id, Vector3 pos)</strong>: Given an id and a position, returns a VolumeQueryResult struct.</p></li>
<li><p><strong>CloudLineQuery (int id, Vector3 startpos, Vector3 endpos)</strong>: Given an id, a start position and an end position, returns a LineQueryResult struct.</p></li>
<li><p><strong>GetCloudAtPosition (Vector3 pos)</strong>: Returns the amount of cloud at the given position, as a float value 0.0 to 1.0.</p></li>
<li><p><strong>GetCloudShadowAtPosition (Vector3 pos)</strong>: Returns the amount of cloud shadow at the given position, as a float value 0.0 to 1.0.</p></li>
<li><p><strong>GetPrecipitationAtPosition (Vector3 pos)</strong>: Returns the amount of rain/snow at the given position, as a float value 0.0 to 1.0.</p></li>
</ul>
<p>The contents of the structs are as follows:</p>
<p><strong>VolumeQueryResult</strong>:</p>
<ul class="simple">
<li><p>vec3 pos_m: The position used for the query (this may be modified from the original position, and projected elsewhere to avoid testing areas we know to not have cloud).</p></li>
<li><p>int valid: Whether the query is valid (1) or not (0). Returns 0 for the first 3 frames.</p></li>
<li><p>float density: The cloud density (0.0 to 1.0).</p></li>
<li><p>float direct_light: The amount of direct light (0.0 to 4.0).</p></li>
<li><p>float indirect_light: The amount of indirect light (0.0 to 4.0).</p></li>
<li><p>float ambient_light: The amount of ambient light (0.0 to 4.0).</p></li>
<li><p>float precipitation: The amount of rain/snow (0.0 to 1.0).</p></li>
</ul>
<p><strong>LineQueryResult</strong>:</p>
<ul class="simple">
<li><p>vec3 pos1_m: The start position used for the query (this may be modified from the original position, and projected elsewhere to avoid testing areas we know to not have cloud).</p></li>
<li><p>vec3 pos2_m: The end position used for the query (this may be modified from the original position, and projected elsewhere to avoid testing areas we know to not have cloud).</p></li>
<li><p>int valid: Whether the query is valid (1) or not (0). Returns 0 for the first 3 frames.</p></li>
<li><p>float density: The cloud density (0.0 to 1.0).</p></li>
<li><p>float visibility: The visibility distance, in km (between 0.1 and 10000.0).</p></li>
<li><p>float optical_thickness_metres: The amount of cloud filling the distance between the start and end positions. If completely cloudy  = distance in metres, if none = 0.</p></li>
<li><p>float first_contact_metres: The distance to the nearest cloud, in metres.</p></li>
</ul>
<p><strong>Storms</strong></p>
<p>The centre of a storm can be set via the SetStormCentre (float x, float y) function. This is equivalent to setting the storm centre via the map window in the sequencer (hence only two axes).</p>
<p><strong>Unity &lt;-&gt; trueSKY Coordinate Conversions</strong></p>
<p>As Unity and trueSKY treat coordinates differently (which axis is considered “up”), these functions are provided to convert between them when needed:</p>
<ul class="simple">
<li><p><strong>Vector3 TrueSkyToUnityPosition(Vector3 ts_pos)</strong>: Takes a trueSKY position and returns the converted Unity position.</p></li>
<li><p><strong>Vector3 TrueSkyToUnityDirection(Vector3 ts_dir)</strong>: Takes a trueSKY direction and returns the converted Unity direction.</p></li>
<li><p><strong>Vector3 UnityToTrueSkyPosition(Vector3 upos)</strong>: Takes a Unity position and returns the converted trueSKY position.</p></li>
<li><p><strong>Vector3 UnityToTrueSkyDirection(Vector3 u_dir)</strong>: Takes a Unity direction and returns the converted trueSKY direction.</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../sdk.html" class="btn btn-neutral float-right" title="trueSKY SDK" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="unitytutorial.html" class="btn btn-neutral float-left" title="Unity Tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2007-2021, Simul Software Ltd.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>